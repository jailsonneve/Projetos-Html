<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Executar Python com Input</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f0f0f0; }
    textarea, input, button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
    }
    pre {
      background: #111;
      color: #0f0;
      padding: 10px;
      white-space: pre-wrap;
      border-radius: 6px;
      min-height: 150px;
    }
  </style>
</head>
<body>
  <h2>Executar Código Python do GitHub</h2>
  <p><strong>URL:</strong> <span id="codigo-url"></span></p>

  <label for="stdin">Entrada simulada (input):</label>
  <textarea id="stdin" rows="5" placeholder="Exemplo:&#10;1&#10;5&#10;2"></textarea>

  <button onclick="executarCodigo()">Executar</button>

  <h3>Saída:</h3>
  <pre id="output">Aguardando execução...</pre>

  <script>
    async function executarCodigo() {
      const params = new URLSearchParams(window.location.search);
      const rawUrl = params.get("raw");
      const output = document.getElementById("output");
      const stdin = document.getElementById("stdin").value;

      if (!rawUrl) {
        output.textContent = "❌ Erro: parâmetro 'raw' ausente na URL.";
        return;
      }

      if (!stdin.trim()) {
        output.textContent = "⚠️ Este código requer entradas via input(). Preencha o campo acima.";
        return;
      }

      document.getElementById("codigo-url").textContent = rawUrl;

      try {
        const res = await fetch(rawUrl);
        if (!res.ok) {
          output.textContent = "❌ Erro ao baixar código: " + res.status;
          return;
        }

        const code = await res.text();

        const response = await fetch("https://emkc.org/api/v2/piston/execute", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            language: "python3",
            version: "3.10.0",
            files: [{ name: "main.py", content: code }],
            stdin: stdin,
          })
        });

        const data = await response.json();

        if (data.run) {
          const saida = data.run.output || data.run.stdout || "Sem saída.";
          const erros = data.run.stderr ? `\n\n⚠️ Erro:\n${data.run.stderr}` : "";
          output.textContent = saida + erros;
        } else {
          output.textContent = "❌ Resposta inesperada da API.";
        }
      } catch (err) {
        output.textContent = "❌ Erro ao executar código: " + err.message;
      }
    }

    // Executa automaticamente ao carregar
    executarCodigo();
  </script>
</body>
</html>